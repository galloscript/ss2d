<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Skeletons Experiment</title>
        <style>
        	body{ font-family: Verdana; }
        	pre
			{
			    -moz-tab-size: 4;
			    -o-tab-size:   4;
			    tab-size:      4;
			}
        </style>
    </head>
    <body>
    	<h4>Skeletal Animations Demo 2</h4>
    	<p> New Spine format support: the skeleton and animations are in the same file. <br/>
    		You can pick and move the Snipeboys.<br />
    		The walking snipeboy will follow your mouse with his head if you move it close enough.
    	</p>
    	<p>Animations created with <a href="http://esotericsoftware.com/" target="_blank">Spine</a></p>
    	<p>
    		Atlas created with <a href="http://www.codeandweb.com/texturepacker" target="_blank">Texture Packer</a><br />
        <p>
        <button onclick="showHideBones();">Show/Hide Bones</button>
        <button onclick="playStop();">Play/Stop Animation</button>
        <br />
        Time Dilation: <span id="dilationValue" style="width: 35px; display: inline-block">1.0</span>
        <button onclick="addDilation(-0.1)">-</button>
        <button onclick="addDilation(0.1)">+</button><br />
        <canvas id="mainCanvas" width="900" height="512">No canvas Support!</canvas>
        <script src="http://galloman.github.com/ss2d/lib/ss2dLib-min.js"></script>
        <script id="skldemo">
var demo = {};
demo.view = new ss2d.View('mainCanvas');

ss2d.ResourceManager.loadResources([
	ss2d.ResourceManager.Loaders.SKELETON,
	'assets/skeletons/snipeboy/snipeboy3.json',
	ss2d.ResourceManager.Loaders.TEXTURE_ATLAS,
	'assets/skeletons/snipeboy/snipeboyBodyparts.json',
	], function(resourceName, numLoaded, totalToLoad)
	{
		console.log(resourceName+' '+numLoaded+'/'+totalToLoad);
	}, function()
	{
        
        demo.view.mBackgroundFillStyle = '#bbbbbb';

        demo.skeleton = new ss2d.SkeletalSprite(100, 250, 1, 
        									   'assets/skeletons/snipeboy/snipeboy3.json',
        									   'assets/skeletons/snipeboy/snipeboyBodyparts.json');
		demo.view.mMainScene.addObject(demo.skeleton);
		demo.skeleton.mPickable = new ss2d.Pickable(demo.skeleton);
		demo.skeleton.mPivotY = -150;
		demo.skeleton.tick = function(deltaTime)
		{
			this.updateAnimation(deltaTime);
		    this.mPickable.tick(deltaTime);
		};
		demo.skeleton.playAnimation('walk');
		
		demo.skeleton.mBoneMap['head'].tick = function(deltaTime)
		{
			var input = ss2d.CURRENT_VIEW.mInput;
			var worldLocation = this.localToWorld(this.mLocation);
			var right = (input.mMouseX > worldLocation.mX) ? true : false;
			var mouseDiff = ss2d.Point.subtractPoints(input.mMousePoint, worldLocation);
			if(right && mouseDiff.length() < 400)
			{
				
				var rot = Math.PI*0.5 - ss2d.Point.angle(mouseDiff, ss2d.Point.Y_AXIS);  
				this.mRotation = (!isNaN(rot) && rot > -0.57 && rot < 0.13)?rot:this.mRotation;
			}
			else
			{
				this.updateBone(deltaTime);
			}
		};
		
		demo.skeleton2 = new ss2d.SkeletalSprite(400, 250, 1, 
        									   'assets/skeletons/snipeboy/snipeboy3.json',
        									   'assets/skeletons/snipeboy/snipeboyBodyparts.json');
		demo.view.mMainScene.addObject(demo.skeleton2);
		demo.skeleton2.mPickable = new ss2d.Pickable(demo.skeleton2);
		demo.skeleton2.mPivotY = -150;
		demo.skeleton2.mScaleX = -1;
		demo.skeleton2.tick = function(deltaTime)
		{
			this.updateAnimation(deltaTime);
		    this.mPickable.tick(deltaTime);
		};
		demo.skeleton2.playAnimation('jump');
		
        demo.view.startLoop();
	});
        </script>
        <script>
        	//button functions
	        			
			function showHideBones()
			{
				demo.skeleton.mShowBones = !demo.skeleton.mShowBones;
				demo.skeleton2.mShowBones = !demo.skeleton2.mShowBones;
			}
			
			function playStop()
			{
				if(demo.skeleton.mCurrentAnimation)
				{
					demo.skeleton.stopAnimation();
					demo.skeleton2.stopAnimation();
				}
				else
				{
					demo.skeleton.playAnimation('walk');
					demo.skeleton2.playAnimation('jump');
				}
			}
			
			function addDilation(dilation)
			{
				demo.skeleton.mTimeDilation += dilation;
				demo.skeleton2.mTimeDilation += dilation;
				document.getElementById('dilationValue').innerHTML = Math.floor(demo.skeleton.mTimeDilation*100)/100;
			}
        </script>
        <pre class="prettyprint" id="code1">
      
		</pre>
      	<script>
        var c1 = document.getElementById('skldemo').innerHTML;
        document.getElementById('code1').innerHTML = c1;
      	</script>
      	<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
      	<link rel="stylesheet" type="text/css" href="http://google-code-prettify.googlecode.com/svn/trunk/styles/desert.css" />
    </body>
</html>
